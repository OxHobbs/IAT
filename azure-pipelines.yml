name: IAT build and release pipeline


phases:
- phase: Build
  queue: Hosted VS2017
  steps:
  - powershell: |
      Install-Module psake -Force
      Install-Module psdeploy -Force
      Install-Module Pester -Force -SkipPublisherCheck
    displayName: Install prerequisites

  - powershell: |
      .\build.ps1 -Task "Analyze"
    displayName: Run Script Analyzer

  - powershell: |
      .\build.ps1 -Task "Test"
    displayName: run unit tests

  - task: PublishTestResults@2
    displayName: 'Publish Test Results **/unittests_report.xml'
    inputs:
      testRunner: NUnit
      testResultsFiles: '**/unittests_report.xml'
      testRunTitle: 'IAT Unit Test Results'

  - powershell: .\build.ps1 -Task "Coverage"
    displayName: run test coverage report